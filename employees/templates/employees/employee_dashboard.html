{% extends "base.html" %}
{% load static %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
   <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet">
 
<style>
.clock-img {
    max-width: 250px;   /* limit size on bigger screens */
    width: 100%;        /* allow shrinking on mobile */
    height: auto;
}
@media (max-width: 480px) {
    .clock-img {
        max-width: 180px;
    }
}

</style>
    
  

 
  <!-- Content -->
  <div class="main-content">
    <!-- <button class="toggle-btn mb-3" onclick="toggleSidebar()">‚ò∞ Menu</button> -->

    <div class="topbar">
    <h5 class="mb-0 text-primary">Welcome, {{ request.user.first_name|default:request.user.username }}</h5>
    </div>
    

<div class="container mt-5">

    <!-- <div class="row mt-5">

        
        <div class="col-lg-6 mb-4">
            <div class="card news-card text-white p-4 rounded shadow-lg">
                <h1 class="mb-4">üì¢ Latest Office News</h1>
                <div id="newsCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2500">
                    <div class="carousel-inner text-center">
                        <div class="carousel-item active">
                            <p class="fs-5"><strong>üéâ Employee of the Month:</strong><br>Rajesh Kumar (Sales)</p>
                        </div>
                        <div class="carousel-item">
                            <p class="fs-5"><strong>üìÖ Holiday:</strong><br>Diwali ‚Äì Nov 10 (Saturday)</p>
                        </div>
                        <div class="carousel-item">
                            <p class="fs-5"><strong>üèÜ Team Achievement:</strong><br>CRM Automation Completed!</p>
                        </div>
                        <div class="carousel-item">
                            <p class="fs-5"><strong>üí¨ Staff Meeting:</strong><br>Monday 10 AM</p>
                        </div>
                        <div class="carousel-item">
                            <p class="fs-5"><strong>üéÇ Birthdays:</strong><br>Priya & Naveen üéà</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<div class="row mb-5">
  <div class="col-lg-6 offset-lg-3 text-center p-4 bg-light rounded shadow">

    <h3 class="text-success mb-3">‚è∞ Punch In / Punch Out</h3>

    <img src="{% static 'images/colorful-dial-kids-watch-rainbow-600nw-2526447245.jpg' %}" 
         width="300" class="mb-3">

    <div class="d-flex justify-content-center gap-3 mb-2">
      <button id="punchInBtn" class="btn btn-success btn-lg" data-url="{% url 'punch_in' %}">Punch In</button>
      <button id="punchOutBtn" class="btn btn-danger btn-lg" data-url="{% url 'punch_out' %}">Punch Out</button>
    </div>

    <div id="punchStatus" class="mt-2 text-center fs-5"></div>

    <h4 class="mt-3 text-primary">Today's Punch Details</h4>

    <table class="table table-bordered text-center mt-2">
        <tr>
            <th>Punch In</th>
            <td>
                {% if today_log and today_log.punch_in %}
                    {{ today_log.punch_in|date:"Y-m-d H:i:s" }}
                {% else %}
                    --:--
                {% endif %}
            </td>
        </tr>

        <tr>
            <th>Punch Out</th>
            <td>
                {% if today_log and today_log.punch_out %}
                    {{ today_log.punch_out|date:"Y-m-d H:i:s" }}
                {% else %}
                    --:--
                {% endif %}
            </td>
        </tr>
    </table>

  </div>
</div>


    
        <div class="col-lg-6 mb-4">
            <div class="bg-light p-4 rounded shadow">
                <h2 class="text-center mb-4 text-success fs-4">üóìÔ∏è Attendance Calendar</h2>

                
                <div class="d-flex justify-content-center mb-3 flex-wrap" id="calendarControls">
                    <button class="btn btn-primary m-1" data-view="dayGridMonth">Month</button>
                    <button class="btn btn-primary m-1" data-view="timeGridWeek">Week</button>
                    <button class="btn btn-primary m-1" data-view="timeGridDay">Day</button>
                    <button class="btn btn-primary m-1" data-view="dayGridYear">Year</button>
                </div>

                
                <div id="attendanceCalendar" style="min-height: 400px;"></div>
            </div>
        </div>

    </div>  -->
<div class="row mt-5">

    <!-- LEFT SIDE: News first, then Clock -->
    <div class="col-lg-6">

        <!-- üì¢ Latest News (TOP) -->
        <div class="card news-card text-white p-4 rounded shadow-lg mb-4">
            <h2 class="mb-4">üì¢ Latest Office News</h2>

            <div id="newsCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="2500">
                <div class="carousel-inner text-center">
                    <div class="carousel-item active">
                        <p class="fs-5"><strong>üéâ Employee of the Month:</strong><br>Rajesh Kumar (Sales)</p>
                    </div>
                    <div class="carousel-item">
                        <p class="fs-5"><strong>üìÖ Holiday:</strong><br>Diwali ‚Äì Nov 10 (Saturday)</p>
                    </div>
                    <div class="carousel-item">
                        <p class="fs-5"><strong>üèÜ Team Achievement:</strong><br>CRM Automation Completed!</p>
                    </div>
                    <div class="carousel-item">
                        <p class="fs-5"><strong>üí¨ Staff Meeting:</strong><br>Monday 10 AM</p>
                    </div>
                    <div class="carousel-item">
                        <p class="fs-5"><strong>üéÇ Birthdays:</strong><br>Priya & Naveen üéà</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‚è∞ Clock (Below News) -->
        <div class="p-4 bg-light rounded shadow text-center">

            <h3 class="text-success mb-3">‚è∞ Punch In / Punch Out</h3>

           <img src="{% static 'images/colorful-dial-kids-watch-rainbow-600nw-2526447245.jpg' %}"
     class="img-fluid clock-img mb-3" alt="Clock">


            <div class="d-flex justify-content-center gap-3 mb-2">
                <button id="punchInBtn" class="btn btn-success btn-lg" data-url="{% url 'punch_in' %}">Punch In</button>
                <button id="punchOutBtn" class="btn btn-danger btn-lg" data-url="{% url 'punch_out' %}">Punch Out</button>
            </div>

            <div id="punchStatus" class="mt-2 text-center fs-5"></div>

            <h4 class="mt-3 text-primary">Today's Punch Details</h4>

            <table class="table table-bordered text-center mt-2">
                <tr>
                    <th>Punch In</th>
                    <td id="punchInTime">
                        {% if today_log and today_log.punch_in %}
                            {{ today_log.punch_in|date:"Y-m-d H:i:s" }}
                        {% else %}
                            --:--
                        {% endif %}
                    </td>
                </tr>

                <tr>
                    <th>Punch Out</th>
                    <td id="punchOutTime">
                        {% if today_log and today_log.punch_out %}
                            {{ today_log.punch_out|date:"Y-m-d H:i:s" }}
                        {% else %}
                            --:--
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>

    </div>

    <!-- RIGHT SIDE: Calendar -->
    <div class="col-lg-6 mt-4 mt-lg-0">
        <div class="bg-light p-4 rounded shadow h-100">

            <h2 class="text-center mb-4 text-success fs-4">üóìÔ∏è Attendance Calendar</h2>

            <!-- View Buttons -->
            <div class="d-flex justify-content-center mb-3 flex-wrap" id="calendarControls">
                <button class="btn btn-primary m-1" data-view="dayGridMonth">Month</button>
                <button class="btn btn-primary m-1" data-view="timeGridWeek">Week</button>
                <button class="btn btn-primary m-1" data-view="timeGridDay">Day</button>
                <button class="btn btn-primary m-1" data-view="dayGridYear">Year</button>
            </div>

            <div id="attendanceCalendar" style="min-height: 450px;"></div>

        </div>
    </div>

</div>

</div>


<!-- üè¢ About Mortza Section -->
<section id="about" class="about-section mt-5 p-4 rounded shadow-lg bg-white" data-aos="fade-up">

  <h2 class="text-center text-success mb-4 fw-bold" data-aos="zoom-in">
    <i class="bi bi-building me-2"></i>About vetri
  </h2>

  <p class="fs-5 text-center text-muted mb-4 px-3" data-aos="fade-up" data-aos-delay="100">
    <strong>Vetri </strong> is a modern HR solution crafted to simplify employee
    data management, attendance tracking, payroll generation, and performance monitoring.
    Built with cutting-edge technologies and a focus on user experience, it enables businesses
    to handle HR operations efficiently and transparently.
  </p>

  <div class="row text-center g-4">
    <div class="col-md-4" data-aos="zoom-in" data-aos-delay="150">
      <div class="border rounded p-4 h-100">
        <i class="bi bi-people-fill fs-1 text-success mb-3"></i>
        <h5 class="fw-bold text-dark">Smart Employee Management</h5>
        <p class="text-muted">Manage employee records, roles, and departments effortlessly from a single dashboard.</p>
      </div>
    </div>

    <div class="col-md-4" data-aos="zoom-in" data-aos-delay="250">
      <div class="border rounded p-4 h-100">
        <i class="bi bi-calendar-check fs-1 text-success mb-3"></i>
        <h5 class="fw-bold text-dark">Attendance & Leave Tracking</h5>
        <p class="text-muted">Real-time tracking of attendance, automated leave approvals, and absence summaries.</p>
      </div>
    </div>

    <div class="col-md-4" data-aos="zoom-in" data-aos-delay="350">
      <div class="border rounded p-4 h-100">
        <i class="bi bi-cash-coin fs-1 text-success mb-3"></i>
        <h5 class="fw-bold text-dark">Payroll Automation</h5>
        <p class="text-muted">Generate salary slips, compute taxes, and process payroll with accuracy and ease.</p>
      </div>
    </div>
  </div>

<div class="text-center mt-4" data-aos="fade-up" data-aos-delay="400">
  <img src="{% static 'images/employee.png' %}" 
       alt="Our Mission"
       class="img-fluid rounded shadow-sm" 
       style="max-height: 280px; object-fit: cover;">
</div>

</section>
 <!-- üü¢ Contact Section -->
<div class="container my-5 py-5" id="contact" data-aos="fade-up" data-aos-delay="200">

    <!-- Company Logo -->
    <div class="text-center mb-4">
        <img src="{% static 'images/Screenshot 2025-11-19 103138.png' %}"
             
             class="img-fluid"
             style="height: 200px; width: auto;">
    </div>

    <!-- 3 Contact Boxes -->
    <div class="row text-center g-4">

        <!-- Address Box -->
        <div class="col-md-4">
            <div class="p-4 border rounded shadow-sm bg-light">
                <div class="mb-2">
                    <i class="bi bi-geo-alt-fill text-danger fs-1"></i>
                </div>
                <h5 class="fw-bold">ADDRESS</h5>
                <p class="text-secondary mb-0">
                 SURANDAI BUS STAND BACKSIDE,
SURANDAI, TENKASI ‚Äì 627 859
                </p>
            </div>
        </div>

        <!-- Phone Box -->
        <div class="col-md-4">
            <div class="p-4 border rounded shadow-sm bg-light">
                <div class="mb-2">
                    <i class="bi bi-telephone-fill text-danger fs-1"></i>
                </div>
                <h5 class="fw-bold">PHONE NUMBER</h5>
                <p class="text-secondary mb-0">
                    8438558527<br>
8438164827
                </p>
            </div>
        </div>

        <!-- Email Box -->
        <div class="col-md-4">
            <div class="p-4 border rounded shadow-sm bg-light">
                <div class="mb-2">
                    <i class="bi bi-envelope-fill text-danger fs-1"></i>
                </div>
                <h5 class="fw-bold">EMAIL <br>ADDRESS</h5>
                <p class="text-secondary mb-0 text-break">
                 vetritechnologysolutions@gmail.com
                </p>
            </div>
        </div>

    </div>
</div>


  
  


    <!-- Scripts -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script> -->
    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

     <!-- <script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('attendanceCalendar');

  var calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      height: 'auto',
      contentHeight: 'auto',
      aspectRatio: window.innerWidth > 768 ? 1.35 : 0.8,
      headerToolbar: false, // hide default header
      events: [
          { title: 'Present', start: '2025-11-01', color: '#28a745' },
          { title: 'Leave', start: '2025-11-05', color: '#dc3545' },
          { title: 'Work From Home', start: '2025-11-08', color: '#ffc107' },
      ],
      windowResize: function() {
          calendar.setOption('aspectRatio', window.innerWidth > 768 ? 1.35 : 0.8);
          calendar.updateSize();
      }
  });

  calendar.render();

  // External buttons functionality
  document.querySelectorAll('#calendarControls button').forEach(function(btn) {
      btn.addEventListener('click', function() {
          var view = this.getAttribute('data-view');
          calendar.changeView(view);
      });
  });
});

</script>  -->

<script>
document.addEventListener('DOMContentLoaded', function() {
  var calendarEl = document.getElementById('attendanceCalendar');

  var calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    headerToolbar: false,
    events: '/attendance-events/'
  });

  calendar.render();

  // Hide attendance events in monthly view
  calendar.on('datesSet', function(info) {
    let isMonth = info.view.type === 'dayGridMonth';
    
    calendar.getEvents().forEach(function(event) {
      if (event.extendedProps.type === "attendance") {
        if (isMonth) {
          event.setProp('display', 'none');
        } else {
          event.setProp('display', 'auto');
        }
      }
    });
  });

  // View buttons
  document.querySelectorAll('#calendarControls button').forEach(function(btn) {
    btn.addEventListener('click', function() {
      calendar.changeView(this.getAttribute('data-view'));
    });
  });
});
</script>


<!-- FullCalendar Core -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<!-- DayGrid (Month view) -->
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/daygrid@6.1.10/index.global.min.js"></script>

<!-- TimeGrid (Week & Day views) -->
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/timegrid@6.1.10/index.global.min.js"></script>

<!-- MultiMonth (Year view) -->
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/multimonth@6.1.10/index.global.min.js"></script>

  <script>
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('active');
    }
  </script>
<script>
  // Sidebar toggle
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    sidebar.classList.toggle('active');
  }

  // === Navbar collapse close on link click ===
  document.addEventListener('DOMContentLoaded', function () {
    const navLinks = document.querySelectorAll('.navbar-nav .nav-link');
    const navbarCollapse = document.querySelector('.navbar-collapse');

    navLinks.forEach(link => {
      link.addEventListener('click', () => {
        const bsCollapse = new bootstrap.Collapse(navbarCollapse, { toggle: false });
        bsCollapse.hide();
      });
    });
  });
</script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const punchInBtn = document.getElementById('punchInBtn');
    const punchOutBtn = document.getElementById('punchOutBtn');
    const punchStatus = document.getElementById('punchStatus');

    function sendPunch(url, btnToDisable, btnToEnable) {
        fetch(url, {
            method: 'POST',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            punchStatus.innerText = data.message;

            // Update Punch In/Out times in template
            if(data.punch_in) document.getElementById('punchInTime').innerText = data.punch_in;
            if(data.punch_out) document.getElementById('punchOutTime').innerText = data.punch_out;

            if(data.status === 'success') {
                if(btnToDisable) btnToDisable.disabled = true;
                if(btnToEnable) btnToEnable.disabled = false;
            }
        })
        .catch(error => {
            punchStatus.innerText = 'Error! Try again.';
            console.error(error);
        });
    }

    punchInBtn.addEventListener('click', () => {
        sendPunch(punchInBtn.dataset.url, punchInBtn, punchOutBtn);
    });

    punchOutBtn.addEventListener('click', () => {
        sendPunch(punchOutBtn.dataset.url, punchOutBtn, null);
    });
});

</script>

{% endblock %}